# Proyecto Árboles - Especificación Técnica

**Última actualización**: 2025-12-04
**Estado actual**: Fase 3 completada | Fase 4 en desarrollo
**Deadline**: 8 de diciembre 2025

---

## 1. Descripción General del Proyecto

Sistema de monitorización y gestión de árboles plantados en centros educativos mediante sensores IoT. El proyecto permite recopilar datos ambientales (temperatura, humedad del suelo, pH, nivel de agua) a través de dispositivos ESP32 y visualizarlos en tiempo real mediante aplicaciones web y móvil.

### 1.1 Objetivos

- Monitorizar el estado de los árboles en tiempo real
- Almacenar histórico de datos ambientales
- Generar alertas cuando los valores estén fuera de rango
- Proporcionar interfaces web y móvil para consulta y gestión
- Facilitar el seguimiento educativo del crecimiento de los árboles

### 1.2 Alcance del Proyecto (Diciembre 2025)

**Implementado (Fases 1-3):**
- [x] Backend API REST con Spring Boot
- [x] Base de datos PostgreSQL + TimescaleDB
- [x] CRUD completo de Centros Educativos y Árboles
- [x] Relación 1:N (Centro → Árboles)
- [x] Validaciones de datos (Bean Validation)
- [x] Estructura completa Frontend React
- [x] Sistema de autenticación (Login/Register)
- [x] Layout responsive
- [x] Componentes comunes reutilizables

**En Desarrollo (Fase 4):**
- [ ] CRUD de Árboles en Frontend React
- [ ] Consumo de API desde React
- [ ] Formularios con validaciones

**Planificado (Fase 5 - Deadline 8 dic):**
- [ ] Aplicación Android con mínimo 4 actividades
- [ ] CRUD de Árboles desde Android
- [ ] Conexión Android → Backend API

**Futuro (Post 8 diciembre):**
- Firmware ESP32 con sensores
- Sistema de alertas y notificaciones
- Visualización de datos en tiempo real desde sensores
- Gráficas históricas
- Despliegue en producción

---

## 2. Arquitectura del Sistema

### 2.1 Componentes Implementados

#### 2.1.1 Backend (API REST) - COMPLETADO

**Tecnología**: Spring Boot 3.5.7 + Java 21

**Estado**: Fases 1 y 2 completadas

**Funcionalidades implementadas**:
- Entidades JPA: Usuario, Rol, CentroEducativo, Arbol, DispositivoEsp32
- Repositorios JPA con queries derivadas
- Controladores REST con validaciones:
  - ArbolController (GET, POST, PUT, DELETE)
  - CentroEducativoController (GET, POST, PUT, DELETE)
  - GET /api/centros/{id}/arboles (relación 1:N)
- Validaciones Bean Validation (@NotBlank, @Past, @DecimalMin/@Max)
- Validaciones lógica de negocio (duplicados)
- Manejo de errores con códigos HTTP apropiados

**Endpoints principales**:

**Centros Educativos**:
- `GET /api/centros` - Listar todos los centros
- `GET /api/centros/{id}` - Obtener centro por ID
- `POST /api/centros` - Crear centro
- `PUT /api/centros/{id}` - Actualizar centro
- `DELETE /api/centros/{id}` - Eliminar centro
- `GET /api/centros/{id}/arboles` - Obtener árboles de un centro (relación 1:N)

**Árboles**:
- `GET /api/arboles` - Listar todos los árboles
- `GET /api/arboles/{id}` - Obtener árbol por ID
- `POST /api/arboles` - Crear árbol
- `PUT /api/arboles/{id}` - Actualizar árbol
- `DELETE /api/arboles/{id}` - Eliminar árbol
- `GET /api/arboles/centro/{centroId}` - Filtrar árboles por centro
- `GET /api/arboles/especie/{especie}` - Filtrar por especie
- `GET /api/arboles/search?nombre={nombre}` - Búsqueda por nombre

#### 2.1.2 Base de Datos - COMPLETADO

**Motor**: PostgreSQL 16.10 + TimescaleDB 2.23.1

**Estado**: Configurada y funcionando

**Entidades implementadas**:
1. **Usuario**: id, email, password, nombre, activo, rol, fecha_registro
2. **CentroEducativo**: id, nombre, direccion, telefono, email, responsable
3. **Arbol**: id, nombre, especie, fecha_plantacion, ubicacion, notas, centro_educativo_id, dispositivo_esp32_id, umbrales
4. **DispositivoEsp32**: id, mac_address, nombre, activo, fecha_registro, ultima_conexion, arbol_id

**Relaciones**:
- Centro ↔ Arbol (OneToMany / ManyToOne)
- Arbol ↔ DispositivoEsp32 (OneToOne bidireccional)

**Scripts SQL disponibles**:
- `backend/create_database.sql` - Crear todas las tablas
- `backend/drop_tables.sql` - Eliminar todas las tablas

#### 2.1.3 Frontend Web - FASE 3 COMPLETADA

**Tecnología**: React 18 + Vite + Tailwind CSS v3

**Estado**: Estructura completa, autenticación implementada

**Estructura implementada**:
```
src/
├── components/
│   ├── common/          # Button, Input, Alert, Spinner
│   ├── layout/          # Header, MainLayout, ProtectedRoute
│   └── component-library/  # Documentación visual de componentes
├── pages/
│   ├── auth/            # Login, Register
│   ├── Dashboard.jsx
│   ├── NotFound.jsx
│   └── arboles/         # (Fase 4 - en desarrollo)
├── context/
│   └── AuthContext.jsx  # Gestión autenticación + localStorage
├── services/
│   └── api.js           # Axios configurado con interceptors
└── App.jsx              # React Router configurado
```

**Características**:
- [x] React Router Dom con rutas públicas y protegidas
- [x] AuthContext con login, register, logout
- [x] Persistencia con localStorage
- [x] Header responsive con navegación dinámica
- [x] Componentes comunes reutilizables con variantes
- [x] Tailwind CSS para estilos
- [x] Axios configurado con baseURL e interceptors

**Pendiente Fase 4**:
- [ ] CRUD Árboles (ListarArboles, CrearArbol, EditarArbol, DetalleArbol)
- [ ] Formularios con validaciones client-side
- [ ] Feedback al usuario (mensajes éxito/error)
- [ ] Mínimo 4 ventanas funcionales
- [ ] Consumo real de API REST

#### 2.1.4 Aplicación Móvil Android - EN DESARROLLO

**Tecnología**: Android SDK 24+ (Android 7.0) + Java

**IDE**: Android Studio

**Estado**: Estructura básica implementada

**Estructura actual**:
```
com/example/proyectoarboles/
├── activities/       # Login, Registrer, ListarArboles, ArbolDetalles
├── adapter/          # ArbolAdapter, BigDecimalStringAdapter
├── api/              # ApiClient, ApiService, AuthInterceptor
└── model/            # Arbol, CentroEducativo
```

**Funcionalidades parciales**:
- [x] Login y Registrer activities
- [x] ListarArboles activity
- [x] ArbolDetalles activity
- [x] Retrofit configurado para consumir API
- [ ] Funcionalidad modificar árbol
- [ ] Funcionalidad eliminar árbol

**Requisitos Fase 5 (Deadline 8 dic)**:
- [ ] Mínimo 4 actividades funcionando completamente
- [ ] Listar árboles por centro educativo
- [ ] Visualizar detalles con datos en tiempo real (simulados)
- [ ] Modificar datos del árbol
- [ ] Eliminar árbol

### 2.2 Componentes Planificados (Post 8 diciembre)

#### 2.2.1 ESP32 + Sensores (Hardware IoT)

**Estado**: Planificación futura

**Tecnología**: ESP32 con firmware en C/C++
**IDE**: Arduino IDE / PlatformIO
**Conectividad**: WiFi

**Sensores contemplados**:
- Temperatura ambiente/suelo
- Humedad del suelo
- pH del suelo
- Nivel de agua

**Protocolo**: HTTP REST POST a backend

**Componentes hardware documentados**: `docs/Componentes para ESP32/Componentes.png`

#### 2.2.2 Sistema de Alertas y Notificaciones

**Estado**: Diseñado pero no implementado

Funcionalidad contemplada para el futuro:
- Alertas configurables por árbol
- Notificaciones cuando valores fuera de rango
- Historial de alertas
- Canales: Email, notificaciones push

---

## 3. Modelo de Datos

### 3.1 Entidades Implementadas

#### 3.1.1 Usuario
```java
@Entity
- id: Long (PK, autogenerado)
- email: String (unique, not null)
- password: String (not null)
- nombre: String (not null)
- activo: Boolean (default true)
- rol: Rol (enum: ADMIN, PROFESOR, ESTUDIANTE, INVITADO)
- fechaRegistro: LocalDateTime
```

#### 3.1.2 CentroEducativo
```java
@Entity
- id: Long (PK, autogenerado)
- nombre: String (unique, not null, not blank)
- direccion: String
- telefono: String
- email: String
- responsable: String
- arboles: List<Arbol> (@OneToMany, @JsonIgnore)
```

**Validaciones**:
- @NotBlank en nombre
- Validación negocio: nombre único (existsByNombre)

#### 3.1.3 Arbol
```java
@Entity
- id: Long (PK, autogenerado)
- nombre: String (not null, not blank)
- especie: String (not null, not blank)
- fechaPlantacion: LocalDate (not null, @Past)
- ubicacion: String
- notas: String (text)
- centroEducativo: CentroEducativo (@ManyToOne, not null)
- dispositivoEsp32: DispositivoEsp32 (@OneToOne, opcional)
- umbralTempMin: BigDecimal (@DecimalMin)
- umbralTempMax: BigDecimal (@DecimalMax)
- umbralHumedadMin: BigDecimal (@DecimalMin)
- umbralHumedadMax: BigDecimal (@DecimalMax)
- umbralPhMin: BigDecimal (@DecimalMin)
- umbralPhMax: BigDecimal (@DecimalMax)
- umbralNivelAguaMin: BigDecimal (@DecimalMin)
- umbralNivelAguaMax: BigDecimal (@DecimalMax)
```

**Validaciones**:
- @NotBlank en nombre, especie
- @NotNull en fechaPlantacion
- @Past en fechaPlantacion (no permite fechas futuras)
- @DecimalMin/@Max en umbrales
- Validación negocio: nombre único por centro (existsByNombreAndCentroEducativo)

#### 3.1.4 DispositivoEsp32
```java
@Entity
- id: Long (PK, autogenerado)
- macAddress: String (unique, not null)
- nombre: String
- activo: Boolean (default true)
- fechaRegistro: LocalDateTime
- ultimaConexion: LocalDateTime
- arbol: Arbol (@OneToOne, opcional)
```

### 3.2 Relaciones Implementadas

#### 3.2.1 Relaciones 1:N (Uno a Muchos)
- **CentroEducativo (1) → Arbol (N)**: Un centro tiene muchos árboles
  - Implementado con @OneToMany en Centro y @ManyToOne en Arbol
  - Endpoint GET /api/centros/{id}/arboles demuestra la relación

#### 3.2.2 Relaciones 1:1 (Uno a Uno)
- **Arbol (1) ↔ DispositivoEsp32 (1)**: Un árbol tiene un dispositivo, un dispositivo monitoriza un árbol
  - Implementado con @OneToOne bidireccional

### 3.3 Entidades Futuras (No implementadas)

Las siguientes entidades están diseñadas pero no implementadas:

- **LecturaSensor**: Serie temporal (TimescaleDB) para datos de sensores
- **Alerta**: Configuración de alertas por árbol
- **Notificacion**: Registro de notificaciones enviadas
- **Usuario_Centro**: Relación N:M entre usuarios y centros

**Documentación completa del modelo**: `docs/04. MODELO_DATOS.md`

---

## 4. Requisitos Académicos

### 4.1 [PGV] Programación de Servicios y Procesos

**Estado Noviembre**: COMPLETADO

**Requisitos cumplidos**:
- [x] 2 endpoints con relación 1:N (CentroEducativo ↔ Arbol)
- [x] GET, POST, PUT, DELETE implementados
- [x] Validaciones de datos (Bean Validation + lógica negocio)
- [x] Testing con Postman completo

**Diciembre (opcional)**:
- [ ] 2-3 endpoints con relación N:M

### 4.2 [DAD] Desarrollo de Aplicaciones Web

**Estado**: Fase 3 completada | Fase 4 en desarrollo

**Estructura** (Completado):
- [x] Componentes organizados y reutilizables
- [x] React Router Dom
- [x] Login + Register
- [ ] Mínimo 4 ventanas (sin contar login/register) - EN DESARROLLO

**Consumo API** (Pendiente):
- [ ] CRUD completo de Árboles

**Diseño** (Completado):
- [x] Estilización con Tailwind CSS
- [x] Navegación clara (Header, menú)
- [ ] Formularios con validaciones - EN DESARROLLO

**Requisitos funcionales**:
- [x] Login/Register con persistencia (localStorage)
- [x] Navegación dinámica
- [ ] Responsive (parcial)
- [ ] Gestión de CRUD - EN DESARROLLO
- [ ] Feedback al usuario - EN DESARROLLO
- [ ] Desplegar en Vercel - PENDIENTE

### 4.3 [AED] Acceso a Datos

**Estado**: COMPLETADO

**Requisitos cumplidos**:
- [x] Diseño esquema E/R
- [x] Transformación E/R → UML
- [x] Transformación UML → Relacional
- [x] Mapeo objeto-relacional (ORM con JPA)
- [x] Mínimo 2 entidades con 1 relación (Implementado: 4 entidades, 2 relaciones)
- [x] Documentación del modelo de datos (`docs/04. MODELO_DATOS.md`)
- [x] Gestor de tareas Git

**Pendiente**:
- [ ] Manual de instalación
- [ ] Manual de usuario
- [ ] Visualización frontend de datos BD (Fase 4)

### 4.4 [PGL] Programación Multimedia y Dispositivos Móviles

**Estado**: Fase 5 - EN DESARROLLO

**Requisitos**:
- [x] Mínimo 4 actividades (Login, Registrer, ListarArboles, ArbolDetalles)
- [x] Listar árboles por centro educativo
- [x] Visualizar detalles del árbol
- [ ] Modificar datos del árbol - PENDIENTE
- [ ] Eliminar árbol - PENDIENTE

---

## 5. Tecnologías y Herramientas

### 5.1 Backend
- **Framework**: Spring Boot 3.5.7
- **Lenguaje**: Java 21
- **Build**: Maven (con Maven Wrapper)
- **ORM**: Spring Data JPA
- **Base de Datos**: PostgreSQL 16.10 + TimescaleDB 2.23.1
- **Testing**: Postman (documentado en `docs/TESTING_POSTMAN_RESULTS.md`)

### 5.2 Frontend
- **Framework**: React 18
- **Build**: Vite
- **Routing**: React Router Dom
- **HTTP Client**: Axios
- **Estilos**: Tailwind CSS v3
- **Gestión Estado**: Context API (AuthContext)
- **Persistencia**: localStorage

### 5.3 Mobile
- **Plataforma**: Android SDK 24+ (Android 7.0 Nougat)
- **Lenguaje**: Java
- **IDE**: Android Studio
- **Build**: Gradle
- **HTTP Client**: Retrofit 2 + OkHttp
- **Diseño**: Material Design

### 5.4 IoT (Futuro)
- **Hardware**: ESP32
- **Lenguaje**: C/C++
- **IDE**: Arduino IDE / PlatformIO
- **Conectividad**: WiFi

### 5.5 Control de Versiones
- **VCS**: Git / GitHub
- **Workflow**: Feature branches → develop → main
- **Documentación**: `docs/01. GIT_WORKFLOW.md`

---

## 6. Estado del Proyecto

**Última actualización**: 2025-12-04

### Completado

**Fase 0: Configuración Inicial**
- Entornos de desarrollo configurados
- PostgreSQL 16.10 + TimescaleDB 2.23.1 instalado
- Repositorio Git estructurado
- Documentación modelo de datos completa

**Fase 1: Backend - Modelo de Datos**
- 4 Entidades JPA con Javadoc y equals/hashCode
- Repositorios JPA con queries derivadas
- Relaciones bidireccionales implementadas
- Aplicación Spring Boot funcional

**Fase 2: Backend - Endpoints 1:N**
- Validaciones completas (Bean Validation + negocio)
- ArbolController completo (CRUD con @Valid)
- CentroEducativoController completo (CRUD + relación 1:N)
- Testing Postman exitoso (12/12 tests)

**Fase 3: Frontend - Estructura**
- React + Vite + Tailwind CSS configurado
- React Router con rutas públicas/protegidas
- AuthContext con localStorage
- Componentes layout (Header, MainLayout)
- Componentes comunes reutilizables
- Login y Register funcionales
- Dashboard con navegación

### En Desarrollo

**Fase 4: Frontend - CRUD Árboles** (En curso)
- [ ] Páginas: ListarArboles, CrearArbol, EditarArbol, DetalleArbol
- [ ] Formularios con validaciones
- [ ] Consumo API REST
- [ ] Feedback usuario (mensajes éxito/error)
- [ ] Mínimo 4 ventanas funcionales

### Planificado (Deadline: 8 diciembre)

**Fase 5: Android - CRUD Árboles**
- [ ] Completar funcionalidad modificar árbol
- [ ] Completar funcionalidad eliminar árbol
- [ ] Testing completo en emulador/dispositivo

**Fase 6: Documentación**
- [ ] Manual de instalación
- [ ] Manual de usuario

**Despliegue**:
- [ ] Frontend en Vercel

### Futuro (Post 8 diciembre)

**Opcional**:
- ESP32 con sensores (firmware + hardware)
- Sistema de alertas y notificaciones
- Visualización datos tiempo real desde sensores
- Gráficas históricas
- Relaciones N:M (Usuario ↔ Centro)
- Gestión completa de usuarios con roles

---

## 7. Documentación Adicional

### Documentos Principales

- [Índice de Documentación](./00.%20INDICE.md) - Índice completo
- [Git Workflow](./01.%20GIT_WORKFLOW.md) - Flujo de trabajo Git
- [Hoja de Ruta](./02.%20HOJA_DE_RUTA.md) - Planificación detallada por fases
- [Modelo de Datos](./04.%20MODELO_DATOS.md) - Diagramas E/R, UML, Relacional
- [Configuración PostgreSQL](./04b.%20CONFIGURACION_POSTGRESQL.md) - Instalación BD
- [Requisitos Académicos](./REQUISITOS.md) - Requisitos por módulo
- [Testing Postman](./TESTING_POSTMAN_RESULTS.md) - Resultados pruebas endpoints

### README por Componente

- [Backend README](../backend/README.md) - API REST con Spring Boot
- [Frontend README](../frontend/README.md) - Aplicación web con React
- [Android README](../android/README.md) - Aplicación móvil Android
- [ESP32 README](../esp32/README.md) - Firmware para dispositivos IoT

### Scripts y Configuración

- `backend/create_database.sql` - Script creación BD completa
- `backend/drop_tables.sql` - Script eliminación tablas
- `backend/src/main/resources/README_CONFIG.md` - Guía configuración segura
- `docs/install-timescaledb.sh` - Script instalación TimescaleDB
- `docs/Componentes para ESP32/Componentes.png` - Lista hardware

---

**Proyecto Final DAM 2025-2026**
**Última actualización**: 2025-12-04
