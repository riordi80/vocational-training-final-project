# Hoja de Ruta - Proyecto Árboles

**Última actualización**: 2026-02-21
**Estado**: [x] Fase 1-7 COMPLETADAS | [x] DESPLIEGUE COMPLETADO | [x] Fase 9 Testing COMPLETADA | [ ] Fases 10-14 Pendientes 2ª Evaluación

---

## REQUISITOS ACADÉMICOS

### [PGV] Backend

- [x] 2 endpoints con relación 1:N (GET, POST, PUT, DELETE)
- [x] Validaciones de datos

**2ª evaluación:**

- [ ] 1 endpoint con relación N:M — GET, POST, PUT, DELETE completos
  - [x] GET /api/usuario-centro/usuario/{id} y /centro/{id}
  - [x] POST /api/usuario-centro
  - [x] DELETE /api/usuario-centro/{id}
  - [ ] PUT /api/usuario-centro/{id} — **pendiente** (ver Fase 11)

---

### [DAD] Frontend React

**1ª evaluación — Estructura:**
- [x] Componentes organizados y reutilizables
- [x] React Router Dom
- [x] Login + Register funcionales (con persistencia)
- [x] Mínimo 4 ventanas (sin contar login/register)

**1ª evaluación — Consumo API:**
- [x] Tantos CRUD como sean necesarios (Árboles completo)

**1ª evaluación — Diseño:**
- [x] Estilización (Tailwind)
- [x] Formularios con validaciones (Login/Register/Árboles)
- [x] Navegación clara (menú hamburguesa, cabecera responsive)

**1ª evaluación — Requisitos funcionales/no funcionales:**
- [x] Responsive (completo con menú hamburguesa)
- [x] Login/Register con persistencia (LocalStorage)
- [x] Desplegar en Vercel (https://vocational-training-final-project.vercel.app/)
- [x] Navegación dinámica
- [x] Gestión de CRUD establecidos (Árboles completo)
- [x] Establecer roles (auth real contra BD con endpoints /api/auth)
- [x] Feedback al usuario (mensajes éxito/error, componentes Alert)

**2ª evaluación — Estructura modular:**
- [x] Separación clara: pages/, components/, services/, hooks/, context/, utils/, tests/
- [x] Componentes reutilizables avanzados (Button, Input, Alert, Spinner, Modal confirmación)
- [x] Sesión de usuario (AuthContext + localStorage)
- [x] Roles/permisos (ADMIN, COORDINADOR — usePermissions, RoleGate)
- [x] Datos de negocio relevantes (lecturas IoT, umbrales, histórico)

**2ª evaluación — Pantallas:**
- [x] Login y Register funcionales (auth real contra BD)
- [x] Mínimo 6 pantallas sin contar login/register (tenemos 8)
- [x] Dashboard/Inicio
- [x] Listado + Detalle + Crear/Editar árbol
- [x] Gestión secundaria (centros educativos)
- [x] Página de administración solo ADMIN (gestión de usuarios)
- [x] Todas las pantallas con contenido real

**2ª evaluación — Testing:**
- [x] Infraestructura Vitest instalada (vitest, @testing-library/react, jsdom)
- [x] Cobertura con @vitest/coverage-v8 configurada
- [x] 21 tests en 7 archivos — todos pasando (ver HOJA_RUTA_TESTING.md)
- [x] Documentación `docs/TESTING_VITEST.md` completa
- [x] ESLint configurado (eslint.config.js)
- [ ] ESLint sin errores (`npm run lint`) — **pendiente verificar** (ver Fase 12)

---

### [AED] Acceso a Datos

- [x] Diseño esquema E/R
- [x] Transformación E/R → UML
- [x] Transformación UML → Relacional
- [x] Mapeo objeto-relacional (ORM)
- [x] Mínimo 2 entidades con 1 relación (HECHO: 4 entidades)
- [x] Documentación del modelo de datos
- [x] Gestor de tareas Git
- [x] Manual de instalación (MANUAL_DE_INSTALACION.md)
- [x] Manual de usuario (MANUAL_DE_USUARIO.md)
- [x] Visualización frontend de datos BD (CRUD completo de árboles)

**2ª evaluación (Rúbrica Calidad del Software):**

- [ ] Historias de usuario / ERS documentadas formalmente (ver Fase 12)
- [ ] Mockups de las pantallas principales (ver Fase 12)
- [ ] Diagrama E/R corregido en notación Chen — en progreso (ERDPlus)

**2ª evaluación (CRUD todas las entidades):**

> El requisito de AED exige: *"CRUD para TODAS las entidades definidas en la BD, incluso si algunas no están en la interfaz gráfica"*

- [x] ArbolController (CRUD completo)
- [x] CentroEducativoController (CRUD completo)
- [x] UsuarioCentroController (GET, POST, DELETE — PUT pendiente)
- [x] AuthController (login + register)
- [ ] DispositivoEsp32Controller (CRUD) — **pendiente** (ver Fase 14)
- [ ] AlertaController (CRUD) — **pendiente** (ver Fase 14)
- [ ] NotificacionController (CRUD) — **pendiente** (ver Fase 14)

---

### [PGL] Android

- [x] Mínimo 4 actividades (Login, Register, ListarCentros, ListarArboles, ArbolDetalles)
- [x] Listar centros educativos
- [x] Listar árboles por centro educativo
- [x] Visualizar detalles del árbol con datos tiempo-real
- [x] Modificar datos del árbol
- [x] Eliminar árbol
- [x] Layout portrait en todas las actividades
- [x] Layout landscape en ListarCentros, ListarArboles, ArbolDetalles

**2ª evaluación:**

- [ ] Histórico de datos (temperatura/humedad) en Android — ver Fase 10
- [ ] Layout landscape en Login y Registrer — ver Fase 10
- [ ] Notificaciones cuando humedad fuera de rango (opcional)
- [ ] Documentación adaptada a la plantilla del módulo PGL

---

### [SOJ] Sostenibilidad

- [x] Ejercicio 1: Economía circular
- [x] Ejercicio 2: Ecodiseño en código

**2ª evaluación:**

- [ ] Ejercicio 3: Análisis Lighthouse

---

## FASES

### Fase 0: Configuración Inicial [x]

- [x] Java 21, Maven, PostgreSQL 16, Node.js, Android Studio
- [x] Repositorio Git
- [x] Base de datos `proyecto_arboles`
- [x] Documentación modelo de datos

---

### Fase 1: Backend - Modelo de Datos [x]

- [x] Proyecto Spring Boot
- [x] Entidades JPA: Usuario, CentroEducativo, Arbol, DispositivoEsp32
- [x] Repositorios JPA
- [x] Relación 1:N: CentroEducativo → Arbol
- [x] Relación 1:1: Arbol ↔ DispositivoEsp32

---

### Fase 2: Backend - Endpoints 1:N [x]

- [x] **2.1** Validaciones en entidades [x] COMPLETO
  - [x] Arbol: @NotBlank, @Past, @DecimalMin/@Max
  - [x] Arbol: @Valid en controller (POST y PUT)
  - [x] CentroEducativo: @NotBlank, @NotNull

- [x] **2.2** ArbolController [x] COMPLETO
  - [x] GET /api/arboles
  - [x] GET /api/arboles/{id}
  - [x] POST /api/arboles (con @Valid)
  - [x] PUT /api/arboles/{id} (con @Valid)
  - [x] DELETE /api/arboles/{id}
  - [x] Endpoints adicionales (por centro, especie, búsqueda)

- [x] **2.3** CentroEducativoController [x] COMPLETO
  - [x] GET /api/centros
  - [x] GET /api/centros/{id}
  - [x] POST /api/centros (con @Valid)
  - [x] PUT /api/centros/{id} (con @Valid)
  - [x] DELETE /api/centros/{id}
  - [x] GET /api/centros/{id}/arboles (relación 1:N)

- [x] **2.4** Evitar loops JSON [x] COMPLETO
  - [x] @JsonIgnore en List<Arbol> de CentroEducativo

- [x] **2.5** Testing Postman [x] COMPLETO
  - [x] Probar endpoints de Arboles (CRUD completo)
  - [x] Probar endpoints de Centros (CRUD completo)
  - [x] Probar relación 1:N (GET /api/centros/{id}/arboles)
  - [x] Validaciones: nombre vacío (400)
  - [x] Validaciones: duplicados (409)
  - [x] Validaciones: fecha futura @Past (400)

---

### Fase 3: Frontend - Estructura [x]

- [x] **3.1** Configurar React [x] COMPLETO
  - [x] Proyecto React con Vite ya estaba creado
  - [x] Tailwind CSS v3 instalado y configurado
  - [x] Estructura de carpetas creada
  - [x] Variables de entorno (.env, .env.example)

- [x] **3.2** React Router Dom [x] COMPLETO
  - [x] React Router Dom ya estaba instalado
  - [x] Estructura de rutas básica implementada
  - [x] Rutas placeholder (login, dashboard, 404)

- [x] **3.3** Axios [x] COMPLETO
  - [x] Instalado axios
  - [x] api.js con baseURL y configuración
  - [x] Interceptors configurados (request/response)

- [x] **3.4** Context de autenticación [x] COMPLETO
  - [x] AuthContext.jsx
  - [x] Gestión de roles (auth real contra BD — mocks eliminados)
  - [x] Persistencia con localStorage

- [x] **3.5** Layout responsive [x] COMPLETO
  - [x] Header.jsx (responsive)
  - [x] MainLayout.jsx
  - [x] ProtectedRoute.jsx

- [x] **3.6** Login.jsx [x] COMPLETO
  - [x] Formulario email/password
  - [x] Persistencia localStorage
  - [x] Validaciones
  - [x] Feedback (mensajes éxito/error)

- [x] **3.7** Register.jsx [x] COMPLETO
  - [x] Formulario
  - [x] Validaciones
  - [x] Feedback (mensajes éxito/error)

- [x] **3.8** Dashboard.jsx [x] COMPLETO
  - [x] Bienvenida personalizada
  - [x] Tarjetas de acceso rápido (Árboles, Centros)
  - [x] Responsive

---

### Fase 4: Frontend - CRUD Árboles [x]

- [x] **4.1** Servicios API [x] COMPLETO
  - [x] arbolesService.js (CRUD completo + búsqueda + filtros)
  - [x] centrosService.js (CRUD completo + relación con árboles)
  - [x] Manejo de errores con try/catch y feedback

- [x] **4.2** Componentes comunes [x] COMPLETO
  - [x] Button.jsx (reutilizable con variantes)
  - [x] Input.jsx (reutilizable con validaciones)
  - [x] Alert.jsx (mensajes éxito/error/warning/info)
  - [x] Spinner.jsx (loading con diferentes tamaños)

- [x] **4.3** ListadoArboles.jsx [x] COMPLETO
  - [x] Tabla/grid responsive (desktop y mobile)
  - [x] Botón añadir árbol
  - [x] Filtro por centro con dropdown
  - [x] Feedback (Spinner loading, Alert errores)
  - [x] Navegación al detalle (click en fila)

- [x] **4.4** DetalleArbol.jsx [x] COMPLETO
  - [x] Datos del árbol (información general y umbrales)
  - [x] Botones editar/eliminar/volver
  - [x] Modal de confirmación para eliminar
  - [x] Responsive
  - [x] Feedback (loading, errores, árbol no encontrado)

- [x] **4.5** FormularioArbol.jsx [x] COMPLETO
  - [x] Crear/editar en el mismo componente (modo dual)
  - [x] Validaciones completas (campos obligatorios, fecha no futura, umbrales)
  - [x] Feedback (éxito/error con navegación y state)
  - [x] Responsive (grid adaptativo)
  - [x] Select de centros educativos
  - [x] Manejo de umbrales opcionales

- [x] **4.6** Rutas [x] COMPLETO
  - [x] /arboles (ListadoArboles)
  - [x] /arboles/nuevo (FormularioArbol - crear)
  - [x] /arboles/:id (DetalleArbol)
  - [x] /arboles/:id/editar (FormularioArbol - editar)

- [x] **4.7** Testing, mejoras responsive y despliegue [COMPLETO]
  - [x] Probar CRUD completo
  - [x] Verificar responsive
  - [x] Menú hamburguesa implementado
  - [x] Refactorización Login/Register con componentes comunes
  - [x] Header usando componente Button
  - [x] Preparar para Vercel (vercel.json configurado, documentación actualizada)

---

### DESPLIEGUE [x]

- [x] **Frontend en Vercel**
  - [x] URL: https://vocational-training-final-project.vercel.app/
  - [x] Configuración de variable de entorno VITE_API_BASE_URL
  - [x] Build y deploy automático desde rama main
  - [x] Responsive verificado en producción

- [x] **Backend en Render**
  - [x] URL: https://proyecto-arboles-backend.onrender.com
  - [x] Configuración con Dockerfile (multi-stage build)
  - [x] Java 21 + Spring Boot 3.x
  - [x] Deploy automático desde rama main
  - [x] Configuración CORS implementada

- [x] **Base de Datos PostgreSQL en Render**
  - [x] PostgreSQL 16 (Internal Database)
  - [x] Configuración con variables de entorno
  - [x] Conexión segura desde backend

- [x] **Integración Frontend-Backend**
  - [x] Configuración CORS correcta (allowedOriginPatterns)
  - [x] Comunicación verificada y funcionando
  - [x] CRUD completo operativo en producción

---

### Fase 5: Android - CRUD Árboles [x]

- [x] **5.1** Configurar Android [x] COMPLETO
  - [x] Retrofit 2.9.0, Gson 2.10.1, OkHttp 4.11.0
  - [x] Permisos INTERNET y ACCESS_NETWORK_STATE

- [x] **5.2** Retrofit [x] COMPLETO
  - [x] RetrofitClient.java configurado con URL Render
  - [x] ArbolApi.java con todos los endpoints CRUD
  - [x] Timeouts: 60 segundos (adecuado para Render free tier)
  - [x] BigDecimalStringAdapter para manejo de números

- [x] **5.3** Modelos [x] COMPLETO
  - [x] Arbol.java (id, nombre, especie, fecha, ubicación, sensores)
  - [x] CentroEducativo.java (id, nombre)
  - [x] Anotaciones @SerializedName para mapeo JSON

- [x] **5.4** LoginActivity [x] COMPLETO
  - [x] Layout con validación de campos
  - [x] Mock login funcional
  - [x] Navegación a ListarArboles

- [x] **5.5** ListadoArbolesActivity [x] COMPLETO
  - [x] RecyclerView con ArbolAdapter optimizado
  - [x] Carga desde API Render con fallback local
  - [x] Click en item para ver detalles
  - [x] Botón eliminar con diálogo de confirmación

- [x] **5.6** DetalleArbolActivity [x] COMPLETO
  - [x] Visualización completa de datos del árbol
  - [x] Datos simulados de sensores (temperatura, humedad, CO2, humedad suelo)
  - [x] Modo edición con toggle TextViews/EditTexts
  - [x] Actualización en API con PUT

- [x] **5.7** Funcionalidad Editar [x] COMPLETO
  - [x] Modo edición integrado en ArbolDetalles
  - [x] Validaciones en campos
  - [x] Botones Guardar/Cancelar
  - [x] Actualización en API

---

### Fase 6: Documentación [x]

- [x] **6.1** Manual de instalación [x] COMPLETO
  - [x] Requisitos generales
  - [x] Backend (referencia a README)
  - [x] Frontend (referencia a README)
  - [x] Android (referencia a manual específico)
  - [x] Base de datos (PostgreSQL + TimescaleDB)

- [x] **6.2** Manual de usuario [x] COMPLETO
  - [x] Aplicación Web (registro, login, CRUD árboles, responsive)
  - [x] Aplicación Android (referencia a manual específico)
  - [x] FAQ extensa (15+ preguntas)
  - [x] Flujos de trabajo comunes
  - [x] Glosario de términos

---

## [ ] PRE-PUBLICACIÓN (antes de subir a Play Store)

### Android - Optimización del APK
- [ ] Activar `isMinifyEnabled = true` en `android/app/build.gradle.kts` (buildTypes → release)
- [ ] Activar `isShrinkResources = true` para reducir tamaño del APK
- [ ] Configurar reglas en `proguard-rules.pro` si hay errores de ofuscación (ClassNotFoundException, etc.)
- [ ] Probar APK release exhaustivamente (todas las funcionalidades)
- [ ] Firmar APK/AAB con keystore de producción (no el de debug)

### Android - Build Variant
- [ ] Verificar que se usa el variant `productionRelease` para el APK final

### General
- [ ] Revisar que todas las URLs apuntan a producción
- [ ] Eliminar logs de debug innecesarios
- [ ] Revisar permisos del AndroidManifest.xml

---

### Fase 7: Endpoints N:M + Roles + Auth real [x]
- [x] Usuario ↔ CentroEducativo (GET, POST, DELETE)
- [x] Sistema de roles simplificado (ADMIN + COORDINADOR + acceso público) — ver [02b. HOJA_RUTA_ROLES.md](./02b.%20HOJA_RUTA_ROLES.md)
- [x] Gestión de usuarios (CRUD + asignación de centros, solo ADMIN)
- [x] Auth real contra BD: `POST /api/auth/login`, `POST /api/auth/register` (AuthController + DTOs)
- [x] Eliminados mocks de AuthContext — login y registro usan API real

### Fase 8: Mejoras [ ]
- Sistema lecturas TimescaleDB
- Sistema alertas
- ESP32

---

### Fase 9: Testing Frontend [x]

- [x] **9.0** Infraestructura Vitest [x] COMPLETO
  - [x] Vitest 4.x + @testing-library/react + @testing-library/user-event instalados
  - [x] `vite.config.js`: jsdom, globals, setupFiles configurados
  - [x] `setupTests.js` con @testing-library/jest-dom

- [x] **9.1** Completar configuración de coverage [x] COMPLETO
  - [x] Instalar `@vitest/coverage-v8`
  - [x] Añadir bloque `coverage` en `vite.config.js`
  - [x] Actualizar scripts en `package.json` (test, test:ui, test:watch, test:coverage)
  - [x] Añadir `/coverage` al `.gitignore`

- [x] **9.2** permissions.test.js — 4 tests (lógica pura, sin mocks) [x] COMPLETO
  - [x] `isAdminUser` returns true for ADMIN role
  - [x] `isAdminUser` returns false for COORDINADOR role
  - [x] `isCoordinadorInCenter` returns true for ADMIN regardless of centroId
  - [x] `isCoordinadorInCenter` returns false when COORDINADOR not assigned to that center

- [x] **9.3** AuthContext.test.jsx — 4 tests (mock de API real) [x] COMPLETO
  - [x] `login` throws error when email is empty
  - [x] `login` sets user in localStorage on successful API call
  - [x] `login` throws correct message on 401 response
  - [x] `logout` removes user from localStorage

- [x] **9.4** arbolesService.test.js — 2 tests (mock de axios) [x] COMPLETO
  - [x] `getArboles` calls GET /arboles and returns data
  - [x] `deleteArbol` throws the original error on API failure

- [x] **9.5** lecturasService.test.js — 2 tests (lógica de composición) [x] COMPLETO
  - [x] `getLecturasByArbol` calls GET with correct URL and params
  - [x] `getUltimaLectura` returns null when content array is empty

- [x] **9.6** FormularioArbol.test.jsx — 2 tests (validación UI) [x] COMPLETO
  - [x] Shows validation errors when required fields are empty
  - [x] Shows error when umbralTempMin is not less than umbralTempMax

- [x] **9.7** ProtectedRoute.test.jsx — 1 test (seguridad de rutas) [x] COMPLETO
  - [x] Redirects to /login when user is not authenticated

- [x] **9.8** Login.test.jsx — 6 tests (flujo UI + mock contexto + navegación) [x] COMPLETO
  - [x] Renders email and password inputs
  - [x] Shows error when email field is empty
  - [x] Shows error when password field is empty
  - [x] Shows error message when login fails
  - [x] Navigates to /dashboard on successful login
  - [x] Disables submit button while login is in progress

- [x] **9.9** docs/TESTING_VITEST.md — documentación completa [x] COMPLETO
  - [x] Setup, comandos, cobertura, guía AAA, mocks, troubleshooting, estructura de archivos

---

### Fase 10: Android — Histórico + Landscape [ ]

- [ ] **10.1** Activity de histórico de datos [PGL]
  - [ ] Nueva `HistoricoArbolActivity.java`
  - [ ] RecyclerView con lecturas (timestamp, temperatura, humedad)
  - [ ] Conexión con `GET /api/lecturas/arbol/{id}`
  - [ ] Navegación desde `ArbolDetalles`

- [ ] **10.2** Landscape layouts pendientes [PGL]
  - [ ] `res/layout-land/activity_login.xml`
  - [ ] `res/layout-land/activity_registrer.xml`

---

### Fase 11: Backend — PUT N:M [ ]

- [ ] **11.1** PUT en UsuarioCentroController [PGV]
  - [ ] `PUT /api/usuario-centro/{id}` (actualizar campo `activo`)
  - [ ] Validaciones (usuario y centro existen)
  - [ ] Testing Postman (verificar los 4 métodos: GET, POST, PUT, DELETE)

---

### Fase 12: Calidad del Software [ ]

- [ ] **12.1** Historias de usuario / ERS [AED]
  - [ ] Documento con historias de usuario por rol (ADMIN, COORDINADOR)
  - [ ] Formato: "Como [rol], quiero [acción] para [objetivo]"
  - [ ] Incluir en documentación del proyecto

- [ ] **12.2** Mockups [AED]
  - [ ] Mockups de las 6+ pantallas principales del frontend
  - [ ] Herramienta libre (Figma, draw.io, excalidraw...)
  - [ ] Incluir en `docs/` o en el README

- [ ] **12.3** Linting [DAD]
  - [ ] Ejecutar `npm run lint` sin errores
  - [ ] Corregir warnings si los hay

---

### Fase 13: SOJ — Análisis Lighthouse [ ]

- [ ] **13.1** Ejecutar Lighthouse en producción
  - [ ] URL: https://vocational-training-final-project.vercel.app/
  - [ ] Categorías: Performance, Accessibility, Best Practices, SEO
  - [ ] Capturas de pantalla de los resultados

- [ ] **13.2** Documento PDF con resultados
  - [ ] Seguir las indicaciones del campus virtual del módulo SOJ
  - [ ] Incluir análisis y conclusiones

---

### Fase 15: Seguridad — JWT + BCrypt [ ]

> Mejora de 2ª evaluación (no es requisito formal de ningún módulo).

- [ ] **15.1** BCrypt para contraseñas
  - [ ] Añadir dependencia `spring-security-crypto` (o Spring Security completo)
  - [ ] Hashear contraseñas en `POST /api/auth/register`
  - [ ] Verificar hash en `POST /api/auth/login`

- [ ] **15.2** JWT
  - [ ] Añadir dependencia `jjwt`
  - [ ] Generar token en login (payload: userId, email, rol)
  - [ ] Filtro de validación de token en cada request protegido
  - [ ] Actualizar frontend: enviar `Authorization: Bearer <token>` en las peticiones
  - [ ] Actualizar Android: enviar cabecera `Authorization` en Retrofit

---

### Fase 14: Backend — CRUD Entidades Pendientes [ ] [AED]

> Requisito AED: CRUD para TODAS las entidades de la BD, aunque no tengan interfaz gráfica.

- [ ] **14.1** DispositivoEsp32Controller
  - [ ] GET /api/dispositivos
  - [ ] GET /api/dispositivos/{id}
  - [ ] POST /api/dispositivos
  - [ ] PUT /api/dispositivos/{id}
  - [ ] DELETE /api/dispositivos/{id}

- [ ] **14.2** AlertaController
  - [ ] GET /api/alertas
  - [ ] GET /api/alertas/{id}
  - [ ] POST /api/alertas
  - [ ] PUT /api/alertas/{id}
  - [ ] DELETE /api/alertas/{id}

- [ ] **14.3** NotificacionController
  - [ ] GET /api/notificaciones
  - [ ] GET /api/notificaciones/{id}
  - [ ] POST /api/notificaciones
  - [ ] PUT /api/notificaciones/{id}
  - [ ] DELETE /api/notificaciones/{id}

---

## Información del Proyecto

**Nombre**: Proyecto Árboles - Sistema de Monitorización de Árboles

**Institución**: IES El Rincón

**Curso**: Desarrollo de Aplicaciones Multiplataforma (DAM) 2025-2026

**Repositorio**: [github.com/riordi80/vocational-training-final-project](https://github.com/riordi80/vocational-training-final-project)

**Última actualización**: 2026-02-20

### Colaboradores

[![riordi80](https://img.shields.io/badge/riordi80-100000?style=for-the-badge&logo=github&logoColor=white)](https://github.com/riordi80) [![Enrique36247](https://img.shields.io/badge/Enrique36247-100000?style=for-the-badge&logo=github&logoColor=white)](https://github.com/Enrique36247)

---

**Proyecto Final DAM 2025-2026** | Desarrollado con Spring Boot, React, Android y ESP32
