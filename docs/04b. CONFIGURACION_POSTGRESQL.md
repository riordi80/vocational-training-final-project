# Guía de Instalación de PostgreSQL 16 + TimescaleDB

**Propósito**: Esta guía cubre la instalación de PostgreSQL 16 y TimescaleDB.

**NOTA**: Esta es una guía de referencia detallada. Para instalación del proyecto completo, sigue el [Manual de Instalación](./MANUAL_DE_INSTALACION.md).

---

## Requisitos Previos

- Sistema operativo: Linux (Debian/Ubuntu), macOS o Windows
- Permisos de administrador (sudo)

---

## Paso 1: Instalar PostgreSQL 16

### En Debian/Ubuntu

```bash
# Actualizar repositorios
sudo apt update

# Instalar PostgreSQL 16
sudo apt install postgresql-16 postgresql-contrib-16

# Verificar instalación
psql --version  # Debe mostrar: psql (PostgreSQL) 16.x

# Verificar que el servicio está corriendo
sudo systemctl status postgresql
```

### En macOS (usando Homebrew)

```bash
# Instalar PostgreSQL
brew install postgresql@16

# Iniciar servicio
brew services start postgresql@16

# Verificar instalación
psql --version
```

### En Windows

1. Descargar el instalador desde: https://www.postgresql.org/download/windows/
2. Ejecutar el instalador (EDB Installer)
3. Seguir el asistente de instalación
4. Anotar la contraseña del usuario `postgres`

---

## Paso 2: Instalar TimescaleDB

### En Debian/Ubuntu

**Opción 1: Usar el script automatizado (Recomendado)**

El proyecto incluye un script que automatiza la instalación de TimescaleDB:

```bash
# Desde la raíz del proyecto (después de clonarlo)
cd docs/
chmod +x install-timescaledb.sh
sudo ./install-timescaledb.sh
```

El script realiza automáticamente:
- Añade el repositorio de TimescaleDB
- Importa la clave GPG
- Instala timescaledb-2-postgresql-16
- Configura TimescaleDB con `timescaledb-tune`
- Reinicia PostgreSQL

**Opción 2: Instalación manual**

```bash
# Añadir repositorio de TimescaleDB
sudo sh -c "echo 'deb https://packagecloud.io/timescale/timescaledb/ubuntu/ $(lsb_release -c -s) main' > /etc/apt/sources.list.d/timescaledb.list"

# Importar clave GPG
wget --quiet -O - https://packagecloud.io/timescale/timescaledb/gpgkey | sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/timescaledb.gpg

# Actualizar e instalar
sudo apt update
sudo apt install timescaledb-2-postgresql-16

# Configurar TimescaleDB
sudo timescaledb-tune --quiet --yes

# Reiniciar PostgreSQL
sudo systemctl restart postgresql

# Verificar instalación
sudo -i -u postgres
psql -c "SELECT default_version FROM pg_available_extensions WHERE name = 'timescaledb';"
exit
```

### En macOS

```bash
# Instalar TimescaleDB
brew tap timescale/tap
brew install timescaledb

# Configurar TimescaleDB
timescaledb-tune --quiet --yes

# Reiniciar PostgreSQL
brew services restart postgresql@16
```

### En Windows

1. Descargar instalador de TimescaleDB: https://www.timescale.com/download
2. Seguir las instrucciones del instalador
3. Reiniciar el servicio de PostgreSQL

---

## Paso 3: Verificar la Instalación

```bash
# Verificar que PostgreSQL está corriendo
sudo systemctl status postgresql

# Verificar versión de PostgreSQL
psql --version

# Acceder a PostgreSQL como superusuario
sudo -i -u postgres
psql

# Dentro de psql, verificar extensiones disponibles
\dx

# Salir
\q
exit
```

---

## Comandos Útiles de PostgreSQL

### Gestión del Servicio

```bash
# Ver estado del servicio
sudo systemctl status postgresql

# Iniciar PostgreSQL
sudo systemctl start postgresql

# Detener PostgreSQL
sudo systemctl stop postgresql

# Reiniciar PostgreSQL
sudo systemctl restart postgresql

# Habilitar inicio automático
sudo systemctl enable postgresql
```

### Comandos dentro de psql

```sql
\l          -- Listar bases de datos
\du         -- Listar usuarios/roles
\dt         -- Listar tablas
\dx         -- Listar extensiones
\c dbname   -- Conectar a base de datos
\q          -- Salir
\?          -- Ayuda de comandos
```

---

## Solución de Problemas Comunes

### Error: "Peer authentication failed"

Esto significa que PostgreSQL está configurado para usar autenticación por peer (usuario del sistema).

**Solución**:

```bash
# Editar configuración
sudo nano /etc/postgresql/16/main/pg_hba.conf

# Buscar las líneas:
local   all             postgres                                peer
local   all             all                                     peer

# Cambiarlas por:
local   all             postgres                                md5
local   all             all                                     md5

# Guardar (Ctrl+O, Enter, Ctrl+X)

# Reiniciar PostgreSQL
sudo systemctl restart postgresql
```

### Error: "Could not connect to server"

**Posibles causas**:
1. PostgreSQL no está corriendo
2. Firewall bloqueando el puerto 5432
3. PostgreSQL escuchando solo en localhost

**Solución**:

```bash
# Verificar que el servicio está corriendo
sudo systemctl status postgresql

# Si no está corriendo, iniciarlo
sudo systemctl start postgresql

# Verificar qué puertos está escuchando
sudo netstat -plunt | grep postgres
```

### Error: TimescaleDB no se puede crear

**Solución**:

```bash
# Verificar que TimescaleDB está instalado
dpkg -l | grep timescale

# Si no está instalado, seguir los pasos del Paso 2

# Verificar configuración de PostgreSQL
sudo nano /etc/postgresql/16/main/postgresql.conf

# Buscar la línea:
# shared_preload_libraries = 'timescaledb'

# Si no existe, añadirla y reiniciar
sudo systemctl restart postgresql
```

---

## Siguientes Pasos

Una vez completada la instalación de PostgreSQL y TimescaleDB:

1. **Configurar el proyecto**: Volver al [Manual de Instalación](./MANUAL_DE_INSTALACION.md) y continuar con la Sección 3 (Configuración de la Base de Datos)
2. **Crear usuario y base de datos** para el proyecto
3. **Configurar el backend** con las credenciales

---

## Recursos Adicionales

- [Documentación oficial de PostgreSQL](https://www.postgresql.org/docs/16/)
- [Documentación oficial de TimescaleDB](https://docs.timescale.com/)
- [Tutorial de PostgreSQL en español](https://www.postgresql.org/docs/16/tutorial.html)

---

## Información del Proyecto

**Nombre**: Proyecto Árboles - Sistema de Monitorización de Árboles

**Institución**: IES El Rincón

**Curso**: Desarrollo de Aplicaciones Multiplataforma (DAM) 2025-2026

**Repositorio**: [github.com/riordi80/vocational-training-final-project](https://github.com/riordi80/vocational-training-final-project)

**Última actualización**: 2025-12-08

### Colaboradores

[![riordi80](https://img.shields.io/badge/riordi80-100000?style=for-the-badge&logo=github&logoColor=white)](https://github.com/riordi80) [![Enrique36247](https://img.shields.io/badge/Enrique36247-100000?style=for-the-badge&logo=github&logoColor=white)](https://github.com/Enrique36247)

---

**Proyecto Final DAM 2025-2026** | Desarrollado con Spring Boot, React, Android y ESP32
